pipeline{
    agent any
    environment{
        PROJEKT_PATH = "BankApp/BankApp/BankApp.csproj"
        BUILD_CONFIG = "Release"
        ARTIFACTS_DIR = "publish"
    }
    stages{
        stage("Checkout Code"){
            steps{
                   git url: 'https://github.com/YannickGongue/BankApp.git',
                       branch: 'main'
                }         
        }
        stage(" Check .Net Version"){
            steps{
                   sh "dotnet --version"
            }
        }
        stage("Restore Dependencies"){
            steps{
                   sh  ''' dotnet restore ${PRJECT_PATH} \
                           -p EnableWindowsTargeting=true 
                       '''
            }
        }
        stage("Build Application"){
            steps{
                   sh  ''' dotnet build ${PROJEKT_PATH} -c ${BUILD_CONFIG} \
                            -p EnableWindowsTargeting=true 
                        '''
            }
        }
        stage("Run Test"){
            steps{
                    sh "echo 'No tests configured yet'"
            }
        }
        stage("Build Artifact"){
            steps{
                   sh '''
                        dotnet publish ${PROJEKT_PATH} \
                             -c ${BUILD_CONFIG} \
                             -o ${ARTIFACTS_DIR}
                      '''
            }
        }
        stage("archive Build output"){
            steps{
                   archiveArtifacts artifacts: "${ARTIFACTS_DIR}/**", allowEmptyArchive: false
            }
        }
        stage("Hello") {
            steps {
                sh 'echo "My first real Jenkins pipeline for .NET! üöÄ"'
            }
        }
    }

    post {
        success {
            echo "‚úÖ Pipeline SUCCESS"
        }
        failure {
            echo "‚ùå Pipeline FAILED"
        }
    }
    
}   
